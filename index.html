<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Route Elevation & Climate‐Aware Energy</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <style>
    body { font-family: sans-serif; max-width: 900px; margin: auto; padding: 1em; }
    #map { width: 100%; height: 400px; margin-bottom: 1em; }
    fieldset { border:1px solid #ccc; padding:0.8em; margin-top:1em; }
    legend { font-weight: bold; }
    form div { margin-bottom: 0.8em; }
    label { display:inline-block; width:180px; vertical-align: top; }
    input, select { width:120px; }
    #results p { margin:0.2em 0; }
    #elevationChart { margin-top:1em; }
  </style>
</head>
<body>
  <h1>Route Elevation & Climate‐Aware Energy</h1>

  <div id="map"></div>
  <div>
    <label><input type="radio" name="mode" value="start" checked /> Start</label>
    <label><input type="radio" name="mode" value="end" /> End</label>
  </div>

  <form id="route-form">
    <fieldset>
      <legend>Route Coordinates</legend>
      <div><label for="start-lat">Start Latitude:</label>
        <input id="start-lat" type="number" step="any" value="37.7749" /></div>
      <div><label for="start-lon">Start Longitude:</label>
        <input id="start-lon" type="number" step="any" value="-122.4194" /></div>
      <div><label for="end-lat">End Latitude:</label>
        <input id="end-lat" type="number" step="any" value="34.0522" /></div>
      <div><label for="end-lon">End Longitude:</label>
        <input id="end-lon" type="number" step="any" value="-118.2437" /></div>
    </fieldset>

    <fieldset>
      <legend>Historical Climate Settings</legend>
      <div><label for="month">Month:</label>
        <select id="month">
          <option value="1">January</option>
          <option value="2">February</option>
          <option value="3">March</option>
          <option value="4">April</option>
          <option value="5">May</option>
          <option value="6">June</option>
          <option value="7">July</option>
          <option value="8">August</option>
          <option value="9">September</option>
          <option value="10">October</option>
          <option value="11">November</option>
          <option value="12">December</option>
        </select>
      </div>
    </fieldset>

    <fieldset>
      <legend>Truck & Energy Parameters</legend>
      <div><label for="mass">Mass (kg):</label>
        <input id="mass" type="number" step="1" value="30000" /></div>
      <div><label for="speed_kmh">Speed (km/h):</label>
        <input id="speed_kmh" type="number" step="0.1" value="72" /></div>
      <div><label for="Crr">Rolling Resistance (Crr):</label>
        <input id="Crr" type="number" step="0.001" value="0.007" /></div>
      <div><label for="Cd">Drag Coefficient (Cd):</label>
        <input id="Cd" type="number" step="0.01" value="0.6" /></div>
      <div><label for="A">Frontal Area (m²):</label>
        <input id="A" type="number" step="0.1" value="8" /></div>
      <div><label for="rho">Air Density (kg/m³):</label>
        <input id="rho" type="number" step="0.01" value="1.225" /></div>
      <div><label for="eff">Drivetrain Eff. (0–1):</label>
        <input id="eff" type="number" step="0.01" value="0.9" /></div>
      <div><label for="regenEff">Regen Eff. (0–1):</label>
        <input id="regenEff" type="number" step="0.01" value="0.6" /></div>
    </fieldset>

    <button type="submit">Analyze Route & Energy</button>
  </form>

  <div id="results"></div>
  <canvas id="elevationChart" width="800" height="400"></canvas>

  <!-- Libraries -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Modules -->
  <script src="energy.js"></script>
  <script src="weather.js"></script>
  <script src="climate_api.js"></script>

  <script>
    let chart;
    const map = L.map("map").setView([37.7749, -122.4194], 5);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { attribution: "© OpenStreetMap contributors" }).addTo(map);

    let startMarker, endMarker, routeLine;
    map.on("click", e => {
      const { lat, lng } = e.latlng;
      const mode = document.querySelector('input[name="mode"]:checked').value;
      if (mode === "start") {
        startMarker && map.removeLayer(startMarker);
        startMarker = L.marker([lat, lng]).addTo(map).bindPopup("Start").openPopup();
        document.getElementById("start-lat").value = lat.toFixed(6);